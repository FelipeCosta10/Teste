var button = document.getElementById('send-button');
var input = document.getElementById('input-email');
var successPanel = document.getElementById('success-panel');
var submitPanel = document.getElementById('submit-panel');

button.onclick = showSuccess;

input.addEventListener('keyup', (event) => {
    const email = input.value;
    var valid = validate(email);

    if (!valid)
        showError();
    else
        enableButton();
});

function validate(email) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(email).toLowerCase());
}

function showError() {
    input.classList.add("uk-form-danger");
    button.disabled = true;
}

function enableButton() {
    input.classList.remove("uk-form-danger");
    button.disabled = false;
}

function showSuccess() {
    const data = {
        name: '',
        email: input.value,
        url: window.location.href
    };
    button.disabled = true;

    axios.post('https://api.balta.io/v1/leads', data)
        .then(function (response) {
            submitPanel.style.display = "none";
            successPanel.style.display = "block";
        }).catch((res) => {
            input.value = "";
            input.classList.remove("uk-form-danger");
            button.disabled = false;
            UIkit.notification({
                message: 'Ops, algo deu errado!',
                status: 'danger',
                pos: 'bottom-center',
                timeout: 5000
            });
        });
}